<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>ADHD Tools</title>
</head>

<body>
    <div class="timer">
        <br>
        <div id="countdown">--:--</div>
        <br>
        <button id="timerStart" onclick="startOrRestartPomodoro()">Start Timer</button>
        <br>
        <br>
        <label for="work" class="timerLabel">Duration of Work (minutes):</label><br>
        <div>
            <input type="number" id="work" name="work" class="timerInput" min="1" max="999" value="25">
        </div>
        <br><br>
        <label for="break" class="timerLabel">Duration of Break (minutes):</label><br>
        <div>
            <input type="number" id="break" name="break" class="timerInput" min="1" max="999" value="5"><br>
        </div>
    </div>

    <div class="scheduleTable">
        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>Subject (in order of priority)</th>
                    <th>Time Needed</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows for generated schedule will go here -->
            </tbody>
        </table>
    </div>

    <div class="toDoChecklist">
        <h2>To-Do Checklist</h2>
        <input type="text" id="newTaskInput" placeholder="Add a new task..." onkeypress="handleKeyPress(event)">
        <div id="toDoList">
            <!-- To-Do items will be added here dynamically -->
        </div>
    </div>

    <br><br><br><br>

    <div>
        <table id="editableTable">
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Due Date (dd/mm/yyyy)</th>
                    <!-- come up with a better method than this for workload. maybe how long it'd take to do? -->
                    <th>Workload</th>
                    <th>Enjoyment</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                </tr>
                <tr>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                </tr>
            </tbody>
        </table>
        <br>
        <button onclick="addRow()">Add Column</button>
        <button onclick="removeRow()">Remove Column</button>
        <button onclick="generateSchedule()">Generate a schedule</button>
        <br>
        <p style="margin-right: 40%;">Rate the subjects you need to do on a scale from 1-10 in regards to Urgency, Workload and how much you enjoy it, then click the "Generate a Schedule" button to create a schedule in order of what subject you should work on first. The time needed
            is calculated by assuming one point in the workload value is the equivalent of 8 minutes of work to complete.</p>
    </div>

    <script>
        var timerRunning = false;
        var countdownInterval;

        function startOrRestartPomodoro() {
            if (timerRunning) {
                clearInterval(countdownInterval);
                timerRunning = false;
                document.getElementById("countdown").innerHTML = "--:--";
                document.getElementById("timerStart").innerHTML = "Start Timer";
            } else {
                var workDuration = parseInt(document.getElementById("work").value);
                var breakDuration = parseInt(document.getElementById("break").value);
                document.getElementById("timerStart").innerHTML = "Stop Timer";

                displayCountdown(workDuration * 60, "Work");
                timerRunning = true;
            }
        }

        function displayCountdown(duration, type) {
            var countdownDisplay = document.getElementById("countdown");

            countdownInterval = setInterval(function() {
                var minutes = Math.floor(duration / 60);
                var seconds = duration % 60;
                countdownDisplay.innerHTML = formatTime(minutes) + ":" + formatTime(seconds);
                duration--;
                if (duration < 0) {
                    clearInterval(countdownInterval);
                    timerRunning = false;
                    if (type === "Work") {
                        alert("Work time's up! Take a break.");
                        displayCountdown(parseInt(document.getElementById("break").value) * 60, "Break");

                    } else {
                        alert("Break time's up! Time to start working again.");
                        displayCountdown(parseInt(document.getElementById("work").value) * 60, "Work");
                    }
                }
            }, 1000);

            function formatTime(time) {
                return (time < 10 ? "0" : "") + time;
            }
        }

        function addRow() {
            var table = document.getElementById('editableTable');
            var newRow = table.insertRow();

            for (var i = 0; i < 4; i++) {
                var cell = newRow.insertCell(i);
                cell.contentEditable = true;
                cell.textContent = '';
            }
        }

        function removeRow() {
            var table = document.getElementById('editableTable');
            var rowCount = table.rows.length;
            if (rowCount > 2) { // Ensure there are always at least 2 rows
                table.deleteRow(rowCount - 1);
            }
        }

        function generateSchedule() {
            var table = document.getElementById('editableTable');
            var values = [];
            var totalTimePerCycle = parseInt(document.getElementById("work").value) + parseInt(document.getElementById("break").value);

            for (var i = 0; i < table.rows.length; i++) {
                var row = table.rows[i];
                var subject = row.cells[0].innerText.trim();
                var urgency = row.cells[1].innerText;
                var initial = urgency.split(/\//);
                var urgency = ([initial[1], initial[0], initial[2]].join('/'));
                var workload = parseInt(row.cells[2].innerText);
                var enjoyment = parseInt(row.cells[3].innerText);

                console.log(urgency);
                const assignmentDate = new Date(urgency);
                const currentDate = new Date();
                console.log(assignmentDate);
                console.log(currentDate);
                const diffTime = Math.abs(currentDate - assignmentDate);
                const days_raw = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                console.log(days_raw + " days");

                if (days_raw > 30) {
                    var days = 30;
                } else if (days_raw <= 30) {
                    var days = Math.ceil(days_raw);
                    days = 30 - days;
                }

                var scale = (1 + (days / 25)) * (workload + enjoyment * 0.4);
                console.log(scale);

                if (!isNaN(workload) && !isNaN(enjoyment)) {
                    var timeNeeded = workload * 8;
                    values.push({
                        subject: subject,
                        scale: scale,
                        timeNeeded: timeNeeded
                    });
                }
            }

            values.sort(function(a, b) {
                return b.scale - a.scale;
            });

            var scheduleTable = document.getElementById('scheduleTable').getElementsByTagName('tbody')[0];
            scheduleTable.innerHTML = '';

            for (var j = 0; j < values.length; j++) {
                var subject = values[j].subject;
                var timeNeeded = values[j].timeNeeded;

                var newRow = scheduleTable.insertRow();
                var subjectCell = newRow.insertCell(0);
                var timeNeededCell = newRow.insertCell(1);

                subjectCell.innerHTML = subject;
                timeNeededCell.innerHTML = timeNeeded + " minutes";
            }
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                addTask();
            }
        }

        function addTask() {
            var taskInput = document.getElementById("newTaskInput");
            var taskText = taskInput.value.trim();

            if (taskText !== "") {
                var toDoList = document.getElementById("toDoList");
                var newTaskItem = document.createElement("div");
                newTaskItem.className = "toDoItem";
                newTaskItem.innerHTML = `
                    <select>
                        <option value="">No parent</option>
                        ${toDoList.innerHTML}
                    </select>
                    <input type="text" value="${taskText}">
                    <button onclick="convertToDropdown(this)">Convert</button>`;
                toDoList.appendChild(newTaskItem);
                taskInput.value = "";
            }
        }

        function convertToDropdown(button) {
            var itemDiv = button.parentNode;
            var taskText = itemDiv.querySelector("input").value;
            var parentSelect = itemDiv.querySelector("select");

            if (taskText !== "") {
                var newTaskOption = document.createElement("option");
                newTaskOption.textContent = taskText;
                parentSelect.appendChild(newTaskOption);

                var newTaskInput = document.createElement("input");
                newTaskInput.type = "text";
                newTaskInput.value = taskText;
                itemDiv.replaceChild(newTaskInput, itemDiv.querySelector("input"));

                button.remove();
            }
        }
    </script>
</body>

</html>
